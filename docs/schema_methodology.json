{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MethodologyModelCard",
  "description": "Schema for defining endurance training models with explicit assumptions and safety gates.",
  "type": "object",
  "required": [
    "id",
    "name",
    "version",
    "philosophy",
    "assumptions",
    "safety_gates",
    "risk_profile"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9_]+$",
      "description": "Unique identifier using snake_case",
      "examples": ["polarized_80_20_v1", "high_volume_base_v2"]
    },
    "name": {
      "type": "string",
      "description": "Human-readable name of the methodology",
      "examples": ["Polarized 80/20 Training", "High Volume Base Building"]
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic versioning (major.minor.patch)",
      "examples": ["1.0.0", "2.1.3"]
    },
    "last_updated": {
      "type": "string",
      "format": "date",
      "description": "ISO 8601 date of last model card revision"
    },
    "philosophy": {
      "type": "object",
      "required": ["one_line_description", "core_logic"],
      "properties": {
        "one_line_description": {
          "type": "string",
          "description": "Concise summary of the methodology's approach",
          "examples": ["80% low-intensity, 20% high-intensity distribution"]
        },
        "core_logic": {
          "type": "string",
          "description": "Detailed explanation of the underlying physiological rationale",
          "examples": [
            "Maximizes aerobic development while minimizing injury risk through careful intensity distribution"
          ]
        },
        "metabolic_focus": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "aerobic_base",
              "vo2max",
              "lactate_threshold",
              "anaerobic_capacity",
              "neuromuscular_power"
            ]
          },
          "description": "Primary energy systems targeted by this methodology"
        }
      }
    },
    "assumptions": {
      "type": "array",
      "minItems": 1,
      "maxItems": 15,
      "description": "Explicit list of what this methodology assumes to be true about the athlete",
      "items": {
        "type": "object",
        "required": ["key", "expectation", "reasoning_justification"],
        "properties": {
          "key": {
            "type": "string",
            "description": "Internal key for mapping to user input data (must match UserProfile schema)",
            "examples": [
              "sleep_hours",
              "injury_status",
              "weekly_volume_hours",
              "stress_level",
              "base_fitness_weeks"
            ]
          },
          "expectation": {
            "type": "string",
            "description": "What the model assumes to be true (human-readable constraint)",
            "examples": [
              "Consistent sleep â‰¥7 hours per night",
              "No active injuries or pain",
              "Base volume established for 4+ weeks",
              "Non-training stress rated as low or moderate"
            ]
          },
          "reasoning_justification": {
            "type": "string",
            "description": "Used in the Reasoning Trace to explain why this assumption matters",
            "examples": [
              "Recovery drives adaptation; insufficient sleep prevents proper intensity execution",
              "Intensity work requires aerobic foundation to avoid injury"
            ]
          },
          "criticality": {
            "type": "string",
            "enum": ["low", "medium", "high"],
            "default": "medium",
            "description": "How essential this assumption is to methodology safety/effectiveness"
          },
          "validation_rule": {
            "type": "string",
            "description": "Pseudo-code or expression for validating this assumption",
            "examples": [
              "user.sleep_hours >= 7.0",
              "user.injury_status == false",
              "user.stress_level in ['low', 'moderate']"
            ]
          }
        }
      }
    },
    "safety_gates": {
      "type": "object",
      "required": ["exclusion_criteria", "refusal_bridge_template"],
      "description": "Circuit breaker configuration for this methodology",
      "properties": {
        "exclusion_criteria": {
          "type": "array",
          "minItems": 1,
          "description": "List of conditions that trigger plan refusal",
          "items": {
            "type": "object",
            "required": ["condition", "threshold", "severity"],
            "properties": {
              "condition": {
                "type": "string",
                "description": "The user profile field being evaluated",
                "examples": ["injury_status", "sleep_hours", "stress_level"]
              },
              "threshold": {
                "type": "string",
                "description": "The trigger value/expression for the circuit breaker",
                "examples": [
                  "true",
                  "< 6.0",
                  "== 'high'",
                  "> 20.0"
                ]
              },
              "severity": {
                "type": "string",
                "enum": ["warning", "blocking"],
                "description": "Whether this triggers a hard refusal or just a warning"
              },
              "validation_logic": {
                "type": "string",
                "description": "Pseudo-code for programmatic validation",
                "examples": [
                  "IF user.injury_status == true THEN REFUSE",
                  "IF user.sleep_hours < 6.0 THEN REFUSE"
                ]
              },
              "bridge_action": {
                "type": "string",
                "description": "Specific recommendation when this gate triggers",
                "examples": [
                  "Seek medical clearance from sports medicine professional",
                  "Establish consistent sleep routine targeting 7.5+ hours",
                  "Reduce non-training stressors or decrease training volume"
                ]
              }
            }
          }
        },
        "refusal_bridge_template": {
          "type": "string",
          "description": "Template for constructive refusal message. Use {placeholders} for dynamic content.",
          "examples": [
            "Cannot generate plan: {condition} violates assumption '{assumption_key}'. Reasoning: {reasoning}. Recommendation: {bridge_action}"
          ]
        }
      }
    },
    "risk_profile": {
      "type": "object",
      "required": ["fragility_score", "sensitivity_factors"],
      "description": "Characterization of this methodology's robustness and risk factors",
      "properties": {
        "fragility_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Base fragility score for this methodology. 0 = Robust, 1 = Extremely Fragile",
          "examples": [0.3, 0.6, 0.85]
        },
        "sensitivity_factors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Variables that significantly impact plan success when changed",
          "examples": [
            ["sleep_consistency", "stress_load", "nutrition_timing"],
            ["weekly_volume", "injury_history", "recovery_capacity"]
          ]
        },
        "fragility_calculation_weights": {
          "type": "object",
          "description": "Weights for calculating user-specific fragility score",
          "properties": {
            "sleep_deviation": {
              "type": "number",
              "description": "Weight for sleep hours below optimal"
            },
            "stress_multiplier": {
              "type": "number",
              "description": "Multiplier for high stress conditions"
            },
            "volume_variance": {
              "type": "number",
              "description": "Weight for weekly volume instability"
            }
          }
        }
      }
    },
    "failure_modes": {
      "type": "array",
      "description": "Known patterns of plan breakdown and early warning signals",
      "items": {
        "type": "object",
        "required": ["condition", "early_warning_signals"],
        "properties": {
          "condition": {
            "type": "string",
            "description": "Scenario that leads to plan failure",
            "examples": [
              "Missed 2+ high-intensity sessions in same week",
              "Sleep average drops below 6hrs for 3+ consecutive days",
              "Injury during peak volume phase"
            ]
          },
          "early_warning_signals": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Observable indicators that this failure mode is developing",
            "examples": [
              ["elevated_resting_hr", "persistent_fatigue", "motivation_decline"],
              ["sleep_disruption", "irritability", "decreased_performance"]
            ]
          },
          "mitigation_strategy": {
            "type": "string",
            "description": "Recommended intervention to prevent full failure",
            "examples": [
              "Insert 3-5 day recovery block with reduced volume and no intensity",
              "Replace high-intensity with aerobic sessions for 1 week"
            ]
          }
        }
      }
    },
    "references": {
      "type": "array",
      "description": "Scientific literature or expert sources supporting this methodology",
      "items": {
        "type": "object",
        "properties": {
          "citation": {
            "type": "string",
            "description": "APA-style citation"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "Link to source if available"
          },
          "relevance": {
            "type": "string",
            "description": "How this source supports the methodology"
          }
        }
      }
    }
  }
}